<div class="camera-app">

  <main class="app-main">
    <!-- エラーメッセージ -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <!-- Lambda URL入力
    <section class="lambda-config">
      <h2>AWS Lambda設定</h2>
      <div class="input-group">
        <label for="lambdaUrl">Lambda関数URL:</label>
        <input
          type="url"
          id="lambdaUrl"
          [(ngModel)]="lambdaUrl"
          placeholder="https://your-lambda-url.amazonaws.com/..."
          class="url-input">
      </div>
    </section> -->

    <!-- カメラコントロール -->
    <button (click)="startCamera()" class="btn btn-primary">
      カメラを起動
    </button>


    <!-- カメラプレビュー -->
    <section class="camera-preview" *ngIf="isCameraActive">
      <div class="video-container">
        <video
          #videoElement
          autoplay
          playsinline
          muted
          class="video-preview"
          (loadedmetadata)="onVideoLoaded()"
          (error)="onVideoError($event)">
        </video>
        <!-- キャンセルボタン -->
        <button
          (click)="stopCamera()"
          class="cancel-button"
          title="カメラを停止">
          ✕
        </button>
        <!-- 撮影ボタン -->
        <button
          (click)="capturePhoto()"
          [disabled]="isCapturing || capturedImages.length >= 3"
          class="capture-button"
          title="撮影">
        </button>
      </div>
      <div class="camera-info" *ngIf="videoElement">
        <small>
          ビデオ状態: {{ getVideoStatus() }} |
          解像度: {{ getVideoResolution() }}
        </small>
      </div>
    </section>

    <!-- 撮影された画像のプレビュー -->
    <section class="captured-images" *ngIf="capturedImages.length > 0">
      <h2>撮影済み画像 ({{ capturedImages.length }}/3)</h2>
      <div class="image-gallery">
        <div *ngFor="let image of capturedImages; let i = index" class="image-item-small">
          <img
            [src]="image.dataUrl"
            [alt]="'撮影画像 ' + (i + 1)"
            class="captured-image-small"
            (click)="openImageModal(image)"
          >
          <div class="image-number">{{ i + 1 }}</div>
          <button
            class="small-retake-button"
            (click)="retakePhotoAndCloseModal(image.id)"
            title="再撮影">
            再撮影
          </button>
        </div>
      </div>
      <p class="gallery-instruction">クリックして拡大表示</p>
    </section>

    <!-- 画像拡大モーダル -->
    <div class="image-modal" *ngIf="selectedImage" (click)="closeImageModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-image-container">
          <img [src]="selectedImage.dataUrl" [alt]="'撮影画像'" class="modal-image">
        </div>
        <div class="modal-actions">
          <button
            (click)="retakePhotoAndCloseModal(selectedImage.id)"
            class="btn btn-warning">
            再撮影
          </button>
          <button
            (click)="confirmImage()"
            class="btn btn-success">
            OK
          </button>
        </div>
      </div>
    </div>

    <!-- 送信ボタンとクリアボタン -->
    <section class="action-buttons" *ngIf="capturedImages.length > 0">
      <div class="button-group">
        <button
          (click)="sendToLambda()"
          [disabled]="!canSendToLambda()"
          class="btn btn-primary btn-large">
          <span *ngIf="!isProcessing">送信</span>
          <span *ngIf="isProcessing">処理中...</span>
        </button>

        <button
          (click)="clearAll()"
          [disabled]="isProcessing"
          class="btn btn-secondary">
          すべてクリア
        </button>
      </div>
    </section>

    <!-- 抽出されたテキストの表示 -->
    <section class="extracted-text" *ngIf="extractedText">
      <h2>抽出されたテキスト</h2>
      <div class="text-output">
        {{ extractedText }}
      </div>
    </section>
  </main>
</div>
